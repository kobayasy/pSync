<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1039px" preserveAspectRatio="none" style="width:570px;height:1039px;background:#FFFFFF;" version="1.1" viewBox="0 0 570 1039" width="570px" zoomAndPan="magnify"><defs><filter height="300%" id="f3jjahs6xn4il" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="123" x="223.5" y="28.708">pSp1 protocol</text><rect fill="#FFFFFF" filter="url(#f3jjahs6xn4il)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="239.5391"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="354" x="150" y="285.8047"/><rect fill="#FFFFFF" filter="url(#f3jjahs6xn4il)" height="626.3281" style="stroke:#000000;stroke-width:2.0;" width="515" x="9" y="330.9375"/><rect fill="#FFFFFF" filter="url(#f3jjahs6xn4il)" height="566.0625" style="stroke:#000000;stroke-width:2.0;" width="495" x="19" y="384.2031"/><rect fill="#FFFFFF" filter="url(#f3jjahs6xn4il)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="476.6016"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="354" x="150" y="522.8672"/><rect fill="#FFFFFF" filter="url(#f3jjahs6xn4il)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="743.6641"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="354" x="150" y="789.9297"/><rect fill="#FFFFFF" height="43.9375" style="stroke:none;stroke-width:1.0;" width="495" x="19" y="906.3281"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="204" x2="204" y1="91.5469" y2="1032.5313"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="440" x2="440" y1="211.7422" y2="1032.5313"/><rect fill="#FEFECE" filter="url(#f3jjahs6xn4il)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="84" x="160" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="167" y="59.9482">Local host</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="173.5" y="76.2451">(Master)</text><path d="M209,106.5469 L209,161.5469 L561,161.5469 L561,116.5469 L551,106.5469 L209,106.5469 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M551,106.5469 L551,116.5469 L561,116.5469 L551,106.5469 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="215" y="123.6138">stdin: Send sync data from local host to remote</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="331" x="215" y="138.7466">stdout: Receive sync data from remote host to local</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="215" y="153.8794">stderr: Receive status from remote host to local</text><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="374" y1="207.2109" y2="203.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="384" x2="374" y1="207.2109" y2="211.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="385" y1="207.2109" y2="207.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="211" y="187.0122">Connect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="211" y="202.145">(ssh ... 'psync --remote')</text><rect fill="#FEFECE" filter="url(#f3jjahs6xn4il)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="104" x="386" y="170.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="393" y="190.9404">Remote host</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="415" y="207.2373">(Slave)</text><path d="M150,239.5391 L220,239.5391 L220,246.5391 L210,256.5391 L150,256.5391 L150,239.5391 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="239.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="252.606">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="277.8047" y2="273.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="277.8047" y2="281.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="277.8047" y2="277.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="211" y="272.7388">protocol-ID: 'pSp1'</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="504" y1="286.8047" y2="286.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="308.9375" y2="304.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="308.9375" y2="312.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="308.9375" y2="308.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="221" y="303.8716">protocol-ID: 'pSp1'</text><path d="M9,330.9375 L86,330.9375 L86,337.9375 L76,347.9375 L9,347.9375 L9,330.9375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="626.3281" style="stroke:#000000;stroke-width:2.0;" width="515" x="9" y="330.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="24" y="344.0044">loop</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="369.2031" y2="365.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="369.2031" y2="373.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="369.2031" y2="369.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="211" y="364.1372">sync-ID</text><path d="M19,384.2031 L83,384.2031 L83,391.2031 L73,401.2031 L19,401.2031 L19,384.2031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="566.0625" style="stroke:#000000;stroke-width:2.0;" width="495" x="19" y="384.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="34" y="397.27">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="182" x="98" y="396.4136">[Remote have same sync-ID]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="422.4688" y2="418.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="422.4688" y2="426.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="422.4688" y2="422.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="221" y="417.4028">ACK</text><path d="M157,435.4688 L157,460.4688 L486,460.4688 L486,445.4688 L476,435.4688 L157,435.4688 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M476,435.4688 L476,445.4688 L486,445.4688 L476,435.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="254" y="452.5356">Lock sync directory</text><path d="M150,476.6016 L220,476.6016 L220,483.6016 L210,493.6016 L150,493.6016 L150,476.6016 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="476.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="489.6685">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="514.8672" y2="510.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="514.8672" y2="518.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="514.8672" y2="514.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="211" y="509.8013">ACK (Sync directory is ready)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="504" y1="523.8672" y2="523.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="546" y2="542"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="546" y2="550"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="546" y2="546"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="221" y="540.9341">ACK (Sync directory is ready)</text><path d="M157,566 L157,591 L486,591 L486,576 L476,566 L157,566 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M476,566 L476,576 L486,576 L476,566 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="163.5" y="583.0669">Seek files in sync directory to make local file list</text><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="621.2656" y2="617.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="621.2656" y2="625.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="621.2656" y2="621.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="221" y="616.1997">Remote file list ← Local file list</text><path d="M29,634.2656 L29,659.2656 L374,659.2656 L374,644.2656 L364,634.2656 L29,634.2656 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M364,634.2656 L364,644.2656 L374,644.2656 L364,634.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="35" y="651.3325">Merge file list local and remote to make synced list</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="689.5313" y2="685.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="689.5313" y2="693.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="689.5313" y2="689.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="211" y="684.4653">Synced file list</text><path d="M157,702.5313 L157,727.5313 L486,727.5313 L486,712.5313 L476,702.5313 L157,702.5313 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M476,702.5313 L476,712.5313 L486,712.5313 L476,702.5313 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="200.5" y="719.5981">Copy upload files to temporary area</text><path d="M150,743.6641 L220,743.6641 L220,750.6641 L210,760.6641 L150,760.6641 L150,743.6641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="354" x="150" y="743.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="756.731">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="781.9297" y2="777.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="781.9297" y2="785.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="781.9297" y2="781.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="211" y="776.8638">Upload files from temporary area</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="504" y1="790.9297" y2="790.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="813.0625" y2="809.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="813.0625" y2="817.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="813.0625" y2="813.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="221" y="807.9966">Download files to temporary area</text><path d="M148,833.0625 L148,858.0625 L491,858.0625 L491,843.0625 L481,833.0625 L148,833.0625 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M481,833.0625 L481,843.0625 L491,843.0625 L481,833.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="154" y="850.1294">Update files in sync directory from temporary area</text><path d="M157,872.1953 L157,897.1953 L486,897.1953 L486,882.1953 L476,872.1953 L157,872.1953 " fill="#FBFB77" filter="url(#f3jjahs6xn4il)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M476,872.1953 L476,882.1953 L486,882.1953 L476,872.1953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="211.5" y="889.2622">Unlock synchronization directory</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="19" x2="514" y1="907.3281" y2="907.3281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="218" x="24" y="917.5386">[Remote don't have same sync-ID]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="942.2656" y2="938.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="214" y1="942.2656" y2="946.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="942.2656" y2="942.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="221" y="937.1997">NAK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="985.3984" y2="981.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="985.3984" y2="989.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="985.3984" y2="985.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="211" y="980.3325">No more sync-ID</text><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="1014.5313" y2="1010.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="438" x2="428" y1="1014.5313" y2="1018.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="439" y1="1014.5313" y2="1014.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="211" y="1009.4653">Disconnect</text><line style="stroke:#A80036;stroke-width:2.0;" x1="431" x2="449" y1="1005.5313" y2="1023.5313"/><line style="stroke:#A80036;stroke-width:2.0;" x1="431" x2="449" y1="1023.5313" y2="1005.5313"/><!--MD5=[85fa10862de30594864e3b32204bdbc6]
@startuml
title pSp1 protocol

hide footbox

participant "Local host\n(Master)" as local
participant "Remote host\n(Slave)" as remote

note right local
  stdin: Send sync data from local host to remote
  stdout: Receive sync data from remote host to local
  stderr: Receive status from remote host to local
end note
create remote
  local ->> remote: Connect\n(ssh ... 'psync - -remote')
  par
    local ->> remote: protocol-ID: 'pSp1'
  else
    local <<- remote: protocol-ID: 'pSp1'
  end
  loop
    local ->> remote: sync-ID
    alt Remote have same sync-ID
      local <<- remote: ACK
      note over local, remote
        Lock sync directory
      end note
      par
        local ->> remote: ACK (Sync directory is ready)
      else
        local <<- remote: ACK (Sync directory is ready)
      end
      note over local, remote
        Seek files in sync directory to make local file list
      end note
      local <<- remote: Remote file list ← Local file list
      note over local
        Merge file list local and remote to make synced list
      end note
      local ->> remote: Synced file list
      note over local, remote
        Copy upload files to temporary area
      end note
      par
        local ->> remote: Upload files from temporary area
      else
        local <<- remote: Download files to temporary area
      end
      note over local, remote
        Update files in sync directory from temporary area
      end note
      note over local, remote
        Unlock synchronization directory
      end note
    else Remote don't have same sync-ID
      local <<- remote: NAK
    end
  end
  local ->> remote: No more sync-ID
  local ->> remote: Disconnect
destroy remote

@enduml

PlantUML version 1.2022.0(Wed Jan 12 01:16:42 JST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
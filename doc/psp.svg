<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2147px" preserveAspectRatio="none" style="width:723px;height:2147px;background:#FFFFFF;" version="1.1" viewBox="0 0 723 2147" width="723px" zoomAndPan="magnify"><defs><filter height="300%" id="fdt76gm4m5ggt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="123" x="298" y="28.708">pSp1 protocol</text><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="130.6797"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="64.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="223.9453"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="1242.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="678.7344"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="106.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="960.9297"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="373.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="1229.7266"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="106.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="1674.1875"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="2090.9219"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="470.2031"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="64.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="563.4688"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="1227.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="720.8672"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="91.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1003.0625"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="358.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1271.8594"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="91.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1716.3203"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="1992.6563"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="125.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="19" y="177.6797"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="125.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="270" y="517.2031"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="740.8672"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="369" x="150" y="787.1328"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="1041.125" style="stroke:#000000;stroke-width:2.0;" width="700" x="9" y="832.2656"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="980.8594" style="stroke:#000000;stroke-width:2.0;" width="680" x="19" y="885.5313"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="1116.1953"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="369" x="150" y="1162.4609"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="1467.5234"/><rect fill="#FFFFFF" height="31.1328" style="stroke:none;stroke-width:1.0;" width="369" x="150" y="1513.7891"/><rect fill="#FFFFFF" height="43.9375" style="stroke:none;stroke-width:1.0;" width="680" x="19" y="1822.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="204" x2="204" y1="91.5469" y2="2140.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="455" x2="455" y1="420.2734" y2="2140.9219"/><rect fill="#FEFECE" filter="url(#fdt76gm4m5ggt)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="84" x="160" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="167" y="59.9482">Local host</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="173.5" y="76.2451">(Master)</text><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="130.6797"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="64.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="223.9453"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="1242.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="678.7344"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="106.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="960.9297"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="373.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="1229.7266"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="106.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="204" y="1674.1875"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="199" y="2090.9219"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="470.2031"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="64.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="563.4688"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="1227.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="720.8672"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="91.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1003.0625"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="358.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1271.8594"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="91.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="455" y="1716.3203"/><rect fill="#FFFFFF" filter="url(#fdt76gm4m5ggt)" height="25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="1992.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="251" y1="117.6797" y2="117.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251" x2="251" y1="117.6797" y2="130.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="210" x2="251" y1="130.6797" y2="130.6797"/><polygon fill="#A80036" points="220,126.6797,210,130.6797,220,134.6797,216,130.6797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="216" y="112.6138">psp_new()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="251" y1="154.6797" y2="154.6797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="251" x2="251" y1="154.6797" y2="167.6797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="251" y1="167.6797" y2="167.6797"/><polygon fill="#A80036" points="214,163.6797,204,167.6797,214,171.6797,210,167.6797" style="stroke:#A80036;stroke-width:1.0;"/><path d="M19,177.6797 L96,177.6797 L96,184.6797 L86,194.6797 L19,194.6797 L19,177.6797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="125.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="19" y="177.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="34" y="190.7466">loop</text><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="251" y1="210.9453" y2="210.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251" x2="251" y1="210.9453" y2="223.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="210" x2="251" y1="223.9453" y2="223.9453"/><polygon fill="#A80036" points="220,219.9453,210,223.9453,220,227.9453,216,223.9453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="216" y="205.8794">psp_config()</text><path d="M29,241.9453 L29,266.9453 L374,266.9453 L374,251.9453 L364,241.9453 L29,241.9453 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M364,241.9453 L364,251.9453 L374,251.9453 L364,241.9453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="35" y="259.0122">Load list of sync directories from ~/.psync.conf file.</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="251" y1="287.0781" y2="287.0781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="251" x2="251" y1="287.0781" y2="300.0781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="251" y1="300.0781" y2="300.0781"/><polygon fill="#A80036" points="214,296.0781,204,300.0781,214,304.0781,210,300.0781" style="stroke:#A80036;stroke-width:1.0;"/><path d="M209,315.0781 L209,370.0781 L573,370.0781 L573,325.0781 L563,315.0781 L209,315.0781 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M563,315.0781 L563,325.0781 L573,325.0781 L563,315.0781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="215" y="332.145">STDIN: Send sync data from local host to remote</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="215" y="347.2778">STDOUT: Receive sync data from remote host to local</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="215" y="362.4106">STDERR: Receive status from remote host to local</text><line style="stroke:#A80036;stroke-width:1.0;" x1="399" x2="389" y1="415.7422" y2="411.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="399" x2="389" y1="415.7422" y2="419.7422"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="400" y1="415.7422" y2="415.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="211" y="395.5435">Connect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="211" y="410.6763">(ssh ... 'psync --remote')</text><rect fill="#FEFECE" filter="url(#fdt76gm4m5ggt)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="104" x="401" y="379.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="408" y="399.4717">Remote host</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="430" y="415.7686">(Slave)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="455" x2="502" y1="457.2031" y2="457.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="457.2031" y2="470.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="470.2031" y2="470.2031"/><polygon fill="#A80036" points="471,466.2031,461,470.2031,471,474.2031,467,470.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="467" y="452.1372">psp_new()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="502" y1="494.2031" y2="494.2031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="502" x2="502" y1="494.2031" y2="507.2031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="455" x2="502" y1="507.2031" y2="507.2031"/><polygon fill="#A80036" points="465,503.2031,455,507.2031,465,511.2031,461,507.2031" style="stroke:#A80036;stroke-width:1.0;"/><path d="M270,517.2031 L347,517.2031 L347,524.2031 L337,534.2031 L270,534.2031 L270,517.2031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="125.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="270" y="517.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="285" y="530.27">loop</text><line style="stroke:#A80036;stroke-width:1.0;" x1="455" x2="502" y1="550.4688" y2="550.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="550.4688" y2="563.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="563.4688" y2="563.4688"/><polygon fill="#A80036" points="471,559.4688,461,563.4688,471,567.4688,467,563.4688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="467" y="545.4028">psp_config()</text><path d="M280,581.4688 L280,606.4688 L625,606.4688 L625,591.4688 L615,581.4688 L280,581.4688 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M615,581.4688 L615,591.4688 L625,591.4688 L615,581.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="286" y="598.5356">Load list of sync directories from ~/.psync.conf file.</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="502" y1="626.6016" y2="626.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="502" x2="502" y1="626.6016" y2="639.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="455" x2="502" y1="639.6016" y2="639.6016"/><polygon fill="#A80036" points="465,635.6016,455,639.6016,465,643.6016,461,639.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="251" y1="665.7344" y2="665.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251" x2="251" y1="665.7344" y2="678.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="210" x2="251" y1="678.7344" y2="678.7344"/><polygon fill="#A80036" points="220,674.7344,210,678.7344,220,682.7344,216,678.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="216" y="660.6685">psp_run(mode=PSYNC_MASTER)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="455" x2="502" y1="707.8672" y2="707.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="707.8672" y2="720.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="720.8672" y2="720.8672"/><polygon fill="#A80036" points="471,716.8672,461,720.8672,471,724.8672,467,720.8672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="467" y="702.8013">psp_run(mode=PSYNC_SLAVE)</text><path d="M150,740.8672 L220,740.8672 L220,747.8672 L210,757.8672 L150,757.8672 L150,740.8672 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="740.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="753.9341">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="779.1328" y2="775.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="779.1328" y2="783.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="779.1328" y2="779.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="216" y="774.0669">protocol-ID: 'pSp1'</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="519" y1="788.1328" y2="788.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="810.2656" y2="806.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="810.2656" y2="814.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="810.2656" y2="810.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="226" y="805.1997">protocol-ID: 'pSp1'</text><path d="M9,832.2656 L86,832.2656 L86,839.2656 L76,849.2656 L9,849.2656 L9,832.2656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1041.125" style="stroke:#000000;stroke-width:2.0;" width="700" x="9" y="832.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="24" y="845.3325">loop</text><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="870.5313" y2="866.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="870.5313" y2="874.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="870.5313" y2="870.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="216" y="865.4653">sync-ID</text><path d="M19,885.5313 L83,885.5313 L83,892.5313 L73,902.5313 L19,902.5313 L19,885.5313 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="980.8594" style="stroke:#000000;stroke-width:2.0;" width="680" x="19" y="885.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="34" y="898.5981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="182" x="98" y="897.7417">[Remote have same sync-ID]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="923.7969" y2="919.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="923.7969" y2="927.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="923.7969" y2="923.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="226" y="918.731">ACK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="256" y1="947.9297" y2="947.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="256" x2="256" y1="947.9297" y2="960.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="215" x2="256" y1="960.9297" y2="960.9297"/><polygon fill="#A80036" points="225,956.9297,215,960.9297,225,964.9297,221,960.9297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="221" y="942.8638">psync_new()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="507" y1="990.0625" y2="990.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="507" x2="507" y1="990.0625" y2="1003.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466" x2="507" y1="1003.0625" y2="1003.0625"/><polygon fill="#A80036" points="476,999.0625,466,1003.0625,476,1007.0625,472,1003.0625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="472" y="984.9966">psync_new()</text><path d="M157,1021.0625 L157,1046.0625 L501,1046.0625 L501,1031.0625 L491,1021.0625 L157,1021.0625 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,1021.0625 L491,1031.0625 L501,1031.0625 L491,1021.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="261.5" y="1038.1294">Lock sync directory</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="214" x2="256" y1="1066.1953" y2="1066.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="256" x2="256" y1="1066.1953" y2="1079.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="256" y1="1079.1953" y2="1079.1953"/><polygon fill="#A80036" points="219,1075.1953,209,1079.1953,219,1083.1953,215,1079.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="465" x2="507" y1="1093.1953" y2="1093.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="507" x2="507" y1="1093.1953" y2="1106.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="507" y1="1106.1953" y2="1106.1953"/><polygon fill="#A80036" points="470,1102.1953,460,1106.1953,470,1110.1953,466,1106.1953" style="stroke:#A80036;stroke-width:1.0;"/><path d="M150,1116.1953 L220,1116.1953 L220,1123.1953 L210,1133.1953 L150,1133.1953 L150,1116.1953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="1116.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="1129.2622">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="1154.4609" y2="1150.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="1154.4609" y2="1158.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="1154.4609" y2="1154.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="216" y="1149.395">ACK (Sync directory is ready)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="519" y1="1163.4609" y2="1163.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="1185.5938" y2="1181.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="1185.5938" y2="1189.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="1185.5938" y2="1185.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="226" y="1180.5278">ACK (Sync directory is ready)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="256" y1="1216.7266" y2="1216.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="256" x2="256" y1="1216.7266" y2="1229.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="215" x2="256" y1="1229.7266" y2="1229.7266"/><polygon fill="#A80036" points="225,1225.7266,215,1229.7266,225,1233.7266,221,1229.7266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="221" y="1211.6606">psync_run(mode=PSYNC_MASTER)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="507" y1="1258.8594" y2="1258.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="507" x2="507" y1="1258.8594" y2="1271.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466" x2="507" y1="1271.8594" y2="1271.8594"/><polygon fill="#A80036" points="476,1267.8594,466,1271.8594,476,1275.8594,472,1271.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="472" y="1253.7935">psync_run(mode=PSYNC_SLAVE)</text><path d="M157,1289.8594 L157,1314.8594 L501,1314.8594 L501,1299.8594 L491,1289.8594 L157,1289.8594 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,1289.8594 L491,1299.8594 L501,1299.8594 L491,1289.8594 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="171" y="1306.9263">Seek files in sync directory to make local file list</text><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="224" y1="1345.125" y2="1341.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="224" y1="1345.125" y2="1349.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="454" y1="1345.125" y2="1345.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="231" y="1340.0591">Remote file list ← Local file list</text><path d="M29,1358.125 L29,1383.125 L374,1383.125 L374,1368.125 L364,1358.125 L29,1358.125 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M364,1358.125 L364,1368.125 L374,1368.125 L364,1358.125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="35" y="1375.1919">Merge file list local and remote to make synced list</text><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="1413.3906" y2="1409.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="1413.3906" y2="1417.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="454" y1="1413.3906" y2="1413.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="221" y="1408.3247">Synced file list</text><path d="M157,1426.3906 L157,1451.3906 L501,1451.3906 L501,1436.3906 L491,1426.3906 L157,1426.3906 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,1426.3906 L491,1436.3906 L501,1436.3906 L491,1426.3906 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="208" y="1443.4575">Copy upload files to temporary area</text><path d="M150,1467.5234 L220,1467.5234 L220,1474.5234 L210,1484.5234 L150,1484.5234 L150,1467.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="77.3984" style="stroke:#000000;stroke-width:2.0;" width="369" x="150" y="1467.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165" y="1480.5903">par</text><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="1505.7891" y2="1501.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="1505.7891" y2="1509.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="454" y1="1505.7891" y2="1505.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="221" y="1500.7231">Upload files from temporary area</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="150" x2="519" y1="1514.7891" y2="1514.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="224" y1="1536.9219" y2="1532.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="224" y1="1536.9219" y2="1540.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214" x2="454" y1="1536.9219" y2="1536.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="231" y="1531.856">Download files to temporary area</text><path d="M156,1556.9219 L156,1581.9219 L499,1581.9219 L499,1566.9219 L489,1556.9219 L156,1556.9219 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M489,1556.9219 L489,1566.9219 L499,1566.9219 L489,1556.9219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="162" y="1573.9888">Update files in sync directory from temporary area</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="214" x2="256" y1="1602.0547" y2="1602.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="256" x2="256" y1="1602.0547" y2="1615.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="256" y1="1615.0547" y2="1615.0547"/><polygon fill="#A80036" points="219,1611.0547,209,1615.0547,219,1619.0547,215,1615.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="465" x2="507" y1="1629.0547" y2="1629.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="507" x2="507" y1="1629.0547" y2="1642.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="507" y1="1642.0547" y2="1642.0547"/><polygon fill="#A80036" points="470,1638.0547,460,1642.0547,470,1646.0547,466,1642.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="256" y1="1661.1875" y2="1661.1875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="256" x2="256" y1="1661.1875" y2="1674.1875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="215" x2="256" y1="1674.1875" y2="1674.1875"/><polygon fill="#A80036" points="225,1670.1875,215,1674.1875,225,1678.1875,221,1674.1875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="221" y="1656.1216">psync_free()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="507" y1="1703.3203" y2="1703.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="507" x2="507" y1="1703.3203" y2="1716.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466" x2="507" y1="1716.3203" y2="1716.3203"/><polygon fill="#A80036" points="476,1712.3203,466,1716.3203,476,1720.3203,472,1716.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="472" y="1698.2544">psync_free()</text><path d="M157,1734.3203 L157,1759.3203 L501,1759.3203 L501,1744.3203 L491,1734.3203 L157,1734.3203 " fill="#FBFB77" filter="url(#fdt76gm4m5ggt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,1734.3203 L491,1744.3203 L501,1744.3203 L491,1734.3203 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="254.5" y="1751.3872">Unlock sync directory</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="214" x2="256" y1="1779.4531" y2="1779.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="256" x2="256" y1="1779.4531" y2="1792.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="256" y1="1792.4531" y2="1792.4531"/><polygon fill="#A80036" points="219,1788.4531,209,1792.4531,219,1796.4531,215,1792.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="465" x2="507" y1="1806.4531" y2="1806.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="507" x2="507" y1="1806.4531" y2="1819.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="507" y1="1819.4531" y2="1819.4531"/><polygon fill="#A80036" points="470,1815.4531,460,1819.4531,470,1823.4531,466,1819.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="19" x2="699" y1="1823.4531" y2="1823.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="218" x="24" y="1833.6636">[Remote don't have same sync-ID]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="1858.3906" y2="1854.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="219" y1="1858.3906" y2="1862.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="1858.3906" y2="1858.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="226" y="1853.3247">NAK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="1901.5234" y2="1897.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="448" x2="438" y1="1901.5234" y2="1905.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="209" x2="449" y1="1901.5234" y2="1901.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="216" y="1896.4575">No more sync-ID</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="251" y1="1920.5234" y2="1920.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="251" x2="251" y1="1920.5234" y2="1933.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="251" y1="1933.5234" y2="1933.5234"/><polygon fill="#A80036" points="214,1929.5234,204,1933.5234,214,1937.5234,210,1933.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="502" y1="1947.5234" y2="1947.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="502" x2="502" y1="1947.5234" y2="1960.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="455" x2="502" y1="1960.5234" y2="1960.5234"/><polygon fill="#A80036" points="465,1956.5234,455,1960.5234,465,1964.5234,461,1960.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="455" x2="502" y1="1979.6563" y2="1979.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="1979.6563" y2="1992.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="1992.6563" y2="1992.6563"/><polygon fill="#A80036" points="471,1988.6563,461,1992.6563,471,1996.6563,467,1992.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="467" y="1974.5903">psp_free()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="460" x2="502" y1="2016.6563" y2="2016.6563"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="502" x2="502" y1="2016.6563" y2="2029.6563"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="455" x2="502" y1="2029.6563" y2="2029.6563"/><polygon fill="#A80036" points="465,2025.6563,455,2029.6563,465,2033.6563,461,2029.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="2053.7891" y2="2049.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="453" x2="443" y1="2053.7891" y2="2057.7891"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="454" y1="2053.7891" y2="2053.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="211" y="2048.7231">Disconnect</text><line style="stroke:#A80036;stroke-width:2.0;" x1="446" x2="464" y1="2044.7891" y2="2062.7891"/><line style="stroke:#A80036;stroke-width:2.0;" x1="446" x2="464" y1="2062.7891" y2="2044.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="204" x2="251" y1="2077.9219" y2="2077.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="251" x2="251" y1="2077.9219" y2="2090.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="210" x2="251" y1="2090.9219" y2="2090.9219"/><polygon fill="#A80036" points="220,2086.9219,210,2090.9219,220,2094.9219,216,2090.9219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="216" y="2072.856">psp_free()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="209" x2="251" y1="2114.9219" y2="2114.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="251" x2="251" y1="2114.9219" y2="2127.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="251" y1="2127.9219" y2="2127.9219"/><polygon fill="#A80036" points="214,2123.9219,204,2127.9219,214,2131.9219,210,2127.9219" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[9ef1fe78dd100fc859389cee247530ba]
@startuml
title pSp1 protocol

hide footbox

participant "Local host\n(Master)" as local
participant "Remote host\n(Slave)" as remote

/'
Remote STDIN and STDOUT
｜              Local sequence
｜              ｜              Remote sequence
↓               ↓               ↓ 
 '/
                local -> local: psp_new()
                activate local
                  local - -> local
                deactivate local
loop
                local -> local: psp_config()
                activate local
  note over local
    Load list of sync directories from \~/.psync.conf file.
  end note
                  local - -> local
                deactivate local
end
note right local
  STDIN: Send sync data from local host to remote
  STDOUT: Receive sync data from remote host to local
  STDERR: Receive status from remote host to local
end note
create remote
  local - ->> remote: Connect\n(ssh ... 'psync - -remote')
                                remote -> remote: psp_new()
                                activate remote
                                  remote - -> remote
                                deactivate remote
  loop
                                remote -> remote: psp_config()
                                activate remote
    note over remote
      Load list of sync directories from \~/.psync.conf file.
    end note
                                  remote - -> remote
                                deactivate remote
  end
                local -> local: psp_run(mode=PSYNC_MASTER)
                activate local
                                remote -> remote: psp_run(mode=PSYNC_SLAVE)
                                activate remote
  par
    local ->> remote: protocol-ID: 'pSp1'
  else
    local <<- remote: protocol-ID: 'pSp1'
  end
  loop
    local ->> remote: sync-ID
    alt Remote have same sync-ID
      local <<- remote: ACK
                  local -> local: psync_new()
                  activate local
                                  remote -> remote: psync_new()
                                  activate remote
      note over local, remote
        Lock sync directory
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
      par
        local ->> remote: ACK (Sync directory is ready)
      else
        local <<- remote: ACK (Sync directory is ready)
      end
                  local -> local: psync_run(mode=PSYNC_MASTER)
                  activate local
                                  remote -> remote: psync_run(mode=PSYNC_SLAVE)
                                  activate remote
      note over local, remote
        Seek files in sync directory to make local file list
      end note
      local <<- remote: Remote file list ← Local file list
      note over local
        Merge file list local and remote to make synced list
      end note
      local ->> remote: Synced file list
      note over local, remote
        Copy upload files to temporary area
      end note
      par
        local ->> remote: Upload files from temporary area
      else
        local <<- remote: Download files to temporary area
      end
      note over local, remote
        Update files in sync directory from temporary area
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
                  local -> local: psync_free()
                  activate local
                                  remote -> remote: psync_free()
                                  activate remote
      note over local, remote
        Unlock sync directory
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
    else Remote don't have same sync-ID
      local <<- remote: NAK
    end
  end
  local ->> remote: No more sync-ID
                  local - -> local
                deactivate local
                                  remote - -> remote
                                deactivate remote
                                remote -> remote: psp_free()
                                activate remote
                                  remote - -> remote
                                deactivate remote
  local - ->> remote: Disconnect
destroy remote
                local -> local: psp_free()
                activate local
                  local - -> local
                deactivate local

@enduml

@startuml
title pSp1 protocol

hide footbox

participant "Local host\n(Master)" as local
participant "Remote host\n(Slave)" as remote

                local -> local: psp_new()
                activate local
                  local - -> local
                deactivate local
loop
                local -> local: psp_config()
                activate local
  note over local
    Load list of sync directories from \~/.psync.conf file.
  end note
                  local - -> local
                deactivate local
end
note right local
  STDIN: Send sync data from local host to remote
  STDOUT: Receive sync data from remote host to local
  STDERR: Receive status from remote host to local
end note
create remote
  local - ->> remote: Connect\n(ssh ... 'psync - -remote')
                                remote -> remote: psp_new()
                                activate remote
                                  remote - -> remote
                                deactivate remote
  loop
                                remote -> remote: psp_config()
                                activate remote
    note over remote
      Load list of sync directories from \~/.psync.conf file.
    end note
                                  remote - -> remote
                                deactivate remote
  end
                local -> local: psp_run(mode=PSYNC_MASTER)
                activate local
                                remote -> remote: psp_run(mode=PSYNC_SLAVE)
                                activate remote
  par
    local ->> remote: protocol-ID: 'pSp1'
  else
    local <<- remote: protocol-ID: 'pSp1'
  end
  loop
    local ->> remote: sync-ID
    alt Remote have same sync-ID
      local <<- remote: ACK
                  local -> local: psync_new()
                  activate local
                                  remote -> remote: psync_new()
                                  activate remote
      note over local, remote
        Lock sync directory
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
      par
        local ->> remote: ACK (Sync directory is ready)
      else
        local <<- remote: ACK (Sync directory is ready)
      end
                  local -> local: psync_run(mode=PSYNC_MASTER)
                  activate local
                                  remote -> remote: psync_run(mode=PSYNC_SLAVE)
                                  activate remote
      note over local, remote
        Seek files in sync directory to make local file list
      end note
      local <<- remote: Remote file list ← Local file list
      note over local
        Merge file list local and remote to make synced list
      end note
      local ->> remote: Synced file list
      note over local, remote
        Copy upload files to temporary area
      end note
      par
        local ->> remote: Upload files from temporary area
      else
        local <<- remote: Download files to temporary area
      end
      note over local, remote
        Update files in sync directory from temporary area
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
                  local -> local: psync_free()
                  activate local
                                  remote -> remote: psync_free()
                                  activate remote
      note over local, remote
        Unlock sync directory
      end note
                    local - -> local
                  deactivate local
                                    remote - -> remote
                                  deactivate remote
    else Remote don't have same sync-ID
      local <<- remote: NAK
    end
  end
  local ->> remote: No more sync-ID
                  local - -> local
                deactivate local
                                  remote - -> remote
                                deactivate remote
                                remote -> remote: psp_free()
                                activate remote
                                  remote - -> remote
                                deactivate remote
  local - ->> remote: Disconnect
destroy remote
                local -> local: psp_free()
                activate local
                  local - -> local
                deactivate local

@enduml

PlantUML version 1.2021.16(Thu Dec 09 02:25:22 JST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
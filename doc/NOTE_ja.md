<!--
NOTE_ja.md - Last modified: 10-Feb-2026 (kobayasy)
-->

[使い方のヒント](#使い方のヒント) [
	[日本語マニュアル](#日本語マニュアル) |
	[設定ファイルの設定例](#設定ファイルの設定例) |
	[pSync を作った理由](#pSync-を作った理由) |
	[パスワード入力の自動化](#パスワード入力の自動化) |
	[ファイル更新があった時に psync を自動実行](#ファイル更新があった時に-psync-を自動実行)
]
/ [README](../README_ja.md)

---

# 雑記

## 日本語マニュアル
下記のコマンドで `psync` のマニュアルを表示します。
```sh
man 1 psync
```
下記のコマンドで設定ファイル `~/psync.conf` のマニュアルを表示します。
```sh
man 5 psync.conf
```
`No manual entry` のエラーが出る場合は、下記のコマンドをお試しください。
```sh
man -M ~/share/man/ja 1 psync
```
```sh
man -M ~/share/man/ja 5 psync.conf
```
macOSの場合、現時点(Tahoe 26.2)では `man` コマンドが日本語に対応していないため、正しい位置で改行されず読みにくいです。
Homebrew などで対応版をインストールすることで解決できます。

## 設定ファイルの設定例
PCごとに必要なファイルだけを選んで同期するように設定できます。

以下は、設定ファイル `~/.psync.conf` の設定例です。
一部は省略していますが、実際に使用している設定に近い内容を紹介します。

- インターネットサーバ(Linux)
	- 全てのファイルを集約したい。
```
#Label  Directory       Comment
env     pSync/ENV       # 各種設定ファイル集
ptv     pSync/Private   # プライベートなファイル
biz     pSync/Work      # 仕事のファイル
src     src             # 趣味で作っているソフトウェアのソースコード
www     /var/www        # インターネット公開しているWebページのファイル
```

- プライベートPC(macOS)
	- どのPCでも同じ設定で使いたい。
	- プライベートな時間に仕事のファイルは見たくない。
	- インターネットサーバのWebページをリモートで編集したい。
```
#Label  Directory
env     pSync/ENV
ptv     pSync/Private
www     Documents/www
src     Documents/src
```

- 仕事用PC(Linux)
	- どのPCでも同じ設定で使いたい。
	- 集中の邪魔になるのでプライベートなファイルは見たくない。
	- 趣味のソフトウェアも使える部分は仕事に流用したい。
```
#Label  Directory
env     pSync/ENV
biz     pSync/Work
src     src
```

## pSync を作った理由
これは20年以上前の出来事です。

ファイルのバックアップ作業中、コピー元とコピー先のディレクトリ指定を誤り、重要なデータを削除してしまうという経験をしました。
納期の1週間前、納品物すべてを失いました。
古いデータが残らないよう、事前にバックアップ先のディレクトリをすべて削除していたため、バックアップデータもすべて失うことになりました。

一人で担当していたプロジェクトだったため、誰にも頼ることはできませんでした。
納期には間に合わないと覚悟しましたが、「やるだけやってみよう」と必死に復旧作業に取り組みました。
その結果、意外にも3日で復旧を完了させることができました。
幸い、頭の中には作業に必要な知識と手順が残っていたようで、結果的に経験済みの作業を繰り返す形となり、失ったデータよりも高品質な成果物を作成できました。
しかし、二度と同じ思いはしたくありません。

そこで、コピー元とコピー先を自動で判定し、安全にコピーを実行するコマンドを作成しました。
これが pSync です。

## パスワード入力の自動化
バックグラウンドで `psync` を自動実行させる場合、パスワード入力をどう自動化するかが問題になります。
そんな時は、`ssh` 用パスワード自動入力コマンドの `sshpass` で解決できます。
例えば、同期先のホスト名が `example.com`、ユーザー名が `guest` でパスワードが `password` の場合、下記のように実行します。
```sh
sshpass -p password psync guest@example.com
```
`sshpass` の `man` にも記載があるように、この方法は設定ファイルやスクリプトファイルに生のパスワードを記述する必要があり、セキュリティ上危険なため、パスワード認証を止めて公開鍵認証に切り替えることをお勧めします。

## ファイル更新があった時に psync を自動実行
ファイルアクセスを監視し、更新のタイミングでコマンドを実行するツールと組み合わせることで、ファイル更新時に `psync` を自動実行させることが可能です。
例えば、Linux の場合だと `inotify` と組み合わせて、下記のスクリプトで自動実行ができます。
`SYNCDIR`、`SYNCCMD`、`BUFFTIM` は、お使いの環境に合わせて書き換えてください。
```sh
#! /bin/sh

SYNCDIR=~/pSync
SYNCCMD='sshpass -p password psync guest@example.com'
BUFFTIM=10000

$SYNCCMD && exec inotify-hookable -w "`realpath $SYNCDIR`" -i .psync -c "$SYNCCMD" -t "$BUFFTIM" -q
```
